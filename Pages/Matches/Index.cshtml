@page
@model SmartMatchLogger.Pages.Matches.IndexModel
@{
    ViewData["Title"] = "Match Log";
}

@if (TempData["DeleteAllMessage"] != null)
{
    <div class="alert alert-success">@TempData["DeleteAllMessage"]</div>
}



<h1>Match Log</h1>

<p>
    <a asp-page="Create" class="btn btn-success">Add New</a>
</p>

<form method="get" asp-page="Details" onsubmit="return validateSelection();">
    <div class="form-group">
        <label for="matchSelect" class="form-label">Select a Match:</label>
        <select id="matchSelect" name="id" class="form-control">
            <option value="">-- Select a match --</option> 
            @foreach (var item in Model.Match.OrderByDescending(m => m.Date))
            {
                <option value="@item.Id">
                    @item.Date.ToString("MMM dd yyyy") vs @item.Opponent @(item.Winner ? "(W)" : "(L)")
                </option>
            }
        </select>
    </div>

    
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Left-aligned button -->
        <div>
            <button type="submit" class="btn btn-primary w-100">View Match Details</button>
        </div>

        <!-- Right-aligned delete button -->
        <div>
            <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#deleteAllModal">
                Delete All Match Logs
            </button>
        </div>
    </div>


</form>




@section Scripts {
    <script>
        function validateSelection() {
            const matchSelect = document.getElementById("matchSelect");
            const alertBox = document.getElementById("matchAlert");

            if (matchSelect.value === "") {
                alertBox.style.display = "block"; // show the alert
                return false; // block form submission
            }

            return true;
        }

        function dismissAlert() {
            document.getElementById("matchAlert").style.display = "none";
        }
    </script>
}


<div id="matchAlert" class="alert alert-warning alert-dismissible fade show" style="display:none; position: fixed; top: 20px; right: 20px; z-index: 9999;" role="alert">
    Please select a match before continuing.
    <button type="button" class="btn-close" aria-label="Close" onclick="dismissAlert()"></button>
</div>

<!-- Delete All Matches Modal -->
<div class="modal fade" id="deleteAllModal" tabindex="-1" aria-labelledby="deleteAllModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAllModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to permanently delete <strong>all match logs</strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
        <form method="post" asp-page-handler="DeleteAll">
            <button type="submit" class="btn btn-danger">Yes, Delete All</button>
        </form>
      </div>
    </div>
  </div>
</div>
